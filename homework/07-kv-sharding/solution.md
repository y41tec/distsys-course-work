В качестве метода выбора шарда используется consistent hashing:
- вспомогательный класс `KeyStore` поддерживает в поле `_d` отсортированный по значениям хэш-функции дек нод
- вставка и удаление нод реализуется в методах `add_key` и `remove_key` соотвественно
- при добавлении ноды для перераспредления ключей используется метод `split_by_key`
- для лукапа, обновления, добавления и удаления ключа поиск соотвествующей ноды реализован в методе `get_index_by_key` с использованием бинпоиска по значениям хэш-функций на нодах, поэтому сложность этих операций составляет $O(\log n)$.