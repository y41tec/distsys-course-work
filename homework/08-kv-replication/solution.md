# Описание решения
Каждая нода `StorageNode` поддерживает следующие поля:
- `_id` - собственный id
- `_nodes` - список id всех нод
- `_data` - kv-хранилище
- `_events` - ивенты
  
Данные реплицируются на `N` нодах, их список определяет функция `get_key_replicas(key, node_count)`. При поступлении `PUT`, `GET`, `DELETE` запросов нода создает ивент, соотвествующие запросы перенаправляются на оригинальные (ответственные за хранения ключа) ноды. Далее состояние ивента обновляется в двух случаях:
- при поступлении ответа от реплики обновляется поле ивента `resp`, содержащее ноды, ранее обработавшие запрос. После всем репликам с неактуальной версией данных отправляется запрос на обновление (repair), а прошлые результаты удаляются из `resp`. Подобным образом ивент обновляется до тех пор, пока размер `resp` будет не меньше заданного в запросе параметра `quorum`.
- при срабатывании таймера: если за определенное время обновление не было поддержано на `N` нодах, реализуется механизм sloppy-кворумов и hinted handoff, обновления передаются нодам вне `get_key_replicas(key, node_count)`. После того, как обновление поддержано на `N` нодах, ивент удаляется.
  

При поступлении обновления внешнего ключа `key` (который в случае корректной работы ноды не располагаются на этой ноде) нода также создает ивент, обсуживающийся до момента восстановления всех нод `get_key_replicas(key, node_count)`. Нода, хранящая внешние ключи, периодически отправляет их оригинальным репликам в сообщении типа `UPDATE`. После восстановления всех оригинальных реплик ивент удаляется.

# Описание некорректной работы системы:
Пусть система из нод `node_1, node_2, node_3` разделилась на две изолированные по сети компоненты: `node_1, node_2` и `node_3`. Пусть также $W=3$ и $R=1$ ($W+R>3$) и поступает запрос на обновления ключа `key` (`get_key_replicas(key, node_count) = [node_1, node_2, node_3]`). В предложенной реализации в силу циклического сдвига при попытках поддержать обновление на нодах запись ключа `key` дважды произойдет на `node_1`, после чего запрос будет считаться выполненным. Обращение по ключу `key` к `node_3` даст неактуальный результат.